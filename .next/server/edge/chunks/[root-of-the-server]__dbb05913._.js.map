{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/jwtToken.ts"],"sourcesContent":["// lib/jwt.ts\r\nimport { SignJWT, jwtVerify } from \"jose\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET as string;\r\nif (!JWT_SECRET) {\r\n  throw new Error(\"JWT_SECRET is not set in environment variables!\");\r\n}\r\nconst encoder = new TextEncoder();\r\n// Sign JWT (async)\r\n\r\ntype JwtPayload = {\r\n  userId: bigint;\r\n  role: \"CUSTOMER\" | \"ADMIN\" | \"SUPERADMIN\";\r\n};\r\n\r\nexport async function signJwt(payload: JwtPayload): Promise<string> {\r\n  return await new SignJWT({ ...payload, userId: payload.userId.toString() })\r\n    .setProtectedHeader({ alg: \"HS256\", typ: \"JWT\" })\r\n    .setExpirationTime(\"7d\")\r\n    .sign(encoder.encode(JWT_SECRET));\r\n}\r\n\r\nexport async function verifyJwt(token: string): Promise<JwtPayload | null> {\r\n  try {\r\n    const { payload } = await jwtVerify(token, encoder.encode(JWT_SECRET));\r\n    return payload as JwtPayload;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,aAAa;;;;;AACb;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU;AACzC,IAAI,CAAC,YAAY;IACf,MAAM,IAAI,MAAM;AAClB;AACA,MAAM,UAAU,IAAI;AAQb,eAAe,QAAQ,OAAmB;IAC/C,OAAO,MAAM,IAAI,6JAAA,CAAA,UAAO,CAAC;QAAE,GAAG,OAAO;QAAE,QAAQ,QAAQ,MAAM,CAAC,QAAQ;IAAG,GACtE,kBAAkB,CAAC;QAAE,KAAK;QAAS,KAAK;IAAM,GAC9C,iBAAiB,CAAC,MAClB,IAAI,CAAC,QAAQ,MAAM,CAAC;AACzB;AAEO,eAAe,UAAU,KAAa;IAC3C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,CAAA,GAAA,+JAAA,CAAA,YAAS,AAAD,EAAE,OAAO,QAAQ,MAAM,CAAC;QAC1D,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\nimport { verifyJwt } from \"./lib/jwtToken\";\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n\r\n  const token = request.cookies.get(\"token\")?.value;\r\n  const payload = token ? await verifyJwt(token) : null;\r\n\r\n  if (!payload && pathname !== \"/login\") {\r\n    return NextResponse.redirect(new URL(\"/login\", request.url));\r\n  }\r\n\r\n  // ðŸ”’ Redirect signed-in users away from /login\r\n  if (pathname === \"/login\") {\r\n    if (payload?.role === \"CUSTOMER\") {\r\n      return NextResponse.redirect(new URL(\"/\", request.url));\r\n    }\r\n    if (payload?.role === \"ADMIN\") {\r\n      return NextResponse.redirect(new URL(\"/admin/dashboard\", request.url));\r\n    }\r\n    return NextResponse.next(); // fallback: let them see /login\r\n  }\r\n\r\n  // ðŸš« Prevent customers accessing admin\r\n  if (pathname.startsWith(\"/admin\") && payload?.role === \"CUSTOMER\") {\r\n    return NextResponse.redirect(new URL(\"/\", request.url));\r\n  }\r\n\r\n  // ðŸš« Only admins can access /admin\r\n  if (pathname.startsWith(\"/admin\") && payload?.role !== \"ADMIN\") {\r\n    return NextResponse.redirect(new URL(\"/login\", request.url));\r\n  }\r\n\r\n  // ðŸš« Only customers can access /myaccount\r\n  if (pathname.startsWith(\"/myaccount\") && payload?.role !== \"CUSTOMER\") {\r\n    return NextResponse.redirect(new URL(\"/login\", request.url));\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    \"/admin/:path*\",\r\n    \"/admin\",\r\n    \"/myaccount/:path*\",\r\n    \"/myaccount\",\r\n    \"/login\",\r\n    \"/category/:path*\",\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AAEA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;IAC5C,MAAM,UAAU,QAAQ,MAAM,CAAA,GAAA,uHAAA,CAAA,YAAS,AAAD,EAAE,SAAS;IAEjD,IAAI,CAAC,WAAW,aAAa,UAAU;QACrC,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,+CAA+C;IAC/C,IAAI,aAAa,UAAU;QACzB,IAAI,SAAS,SAAS,YAAY;YAChC,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;QACA,IAAI,SAAS,SAAS,SAAS;YAC7B,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,oBAAoB,QAAQ,GAAG;QACtE;QACA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,IAAI,gCAAgC;IAC9D;IAEA,uCAAuC;IACvC,IAAI,SAAS,UAAU,CAAC,aAAa,SAAS,SAAS,YAAY;QACjE,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;IAEA,mCAAmC;IACnC,IAAI,SAAS,UAAU,CAAC,aAAa,SAAS,SAAS,SAAS;QAC9D,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,0CAA0C;IAC1C,IAAI,SAAS,UAAU,CAAC,iBAAiB,SAAS,SAAS,YAAY;QACrE,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;QACA;QACA;QACA;QACA;QACA;KACD;AACH"}}]
}